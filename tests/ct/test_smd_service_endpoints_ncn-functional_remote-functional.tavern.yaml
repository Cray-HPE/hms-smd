# MIT License

# (C) Copyright [2019-2021] Hewlett Packard Enterprise Development LP

# Permission is hereby granted, free of charge, to any person obtaining a
# copy of this software and associated documentation files (the "Software"),
# to deal in the Software without restriction, including without limitation
# the rights to use, copy, modify, merge, publish, distribute, sublicense,
# and/or sell copies of the Software, and to permit persons to whom the
# Software is furnished to do so, subject to the following conditions:

# The above copyright notice and this permission notice shall be included
# in all copies or substantial portions of the Software.

# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
# THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR
# OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
# ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
# OTHER DEALINGS IN THE SOFTWARE.

# Tavern test cases for the Hardware State Manager (HSM) service endpoints API.
# Author: Mitch Schooler
# Service: Hardware State Manager

# HMS test metrics test cases: 26
# 1. GET /ServiceEndpoints API response code
# 2. GET /ServiceEndpoints API response body
# 3. GET /ServiceEndpoints/AccountService API response code
# 4. GET /ServiceEndpoints/AccountService API response body
# 5. GET /ServiceEndpoints?service=AccountService API response code
# 6. GET /ServiceEndpoints/AccountService/RedfishEndpoints/{xname} nodeBMC API response code
# 7. GET /ServiceEndpoints/EventService API response code
# 8. GET /ServiceEndpoints/EventService API response body
# 9. GET /ServiceEndpoints?service=EventService API response code
# 10. GET /ServiceEndpoints/EventService/RedfishEndpoints/{xname} nodeBMC API response code
# 11. GET /ServiceEndpoints/SessionService API response code
# 12. GET /ServiceEndpoints/SessionService API response body
# 13. GET /ServiceEndpoints?service=SessionService API response code
# 14. GET /ServiceEndpoints/SessionService/RedfishEndpoints/{xname} nodeBMC API response code
# 15. GET /ServiceEndpoints/UpdateService API response code
# 16. GET /ServiceEndpoints/UpdateService API response body
# 17. GET /ServiceEndpoints?service=UpdateService API response code
# 18. GET /ServiceEndpoints/UpdateService/RedfishEndpoints/{xname} nodeBMC API response code
# 19. GET /ServiceEndpoints/AccountService/RedfishEndpoints/{xname} valid nonexistent nodeBMC API response code
# 20. GET /ServiceEndpoints/EventService/RedfishEndpoints/{xname} valid nonexistent nodeBMC API response code
# 21. GET /ServiceEndpoints/SessionService/RedfishEndpoints/{xname} valid nonexistent nodeBMC API response code
# 22. GET /ServiceEndpoints/UpdateService/RedfishEndpoints/{xname} valid nonexistent nodeBMC API response code
# 23. GET /ServiceEndpoints/AccountService/RedfishEndpoints/{xname} invalid nodeBMC API response code
# 24. GET /ServiceEndpoints/EventService/RedfishEndpoints/{xname} invalid nodeBMC API response code
# 25. GET /ServiceEndpoints/SessionService/RedfishEndpoints/{xname} invalid nodeBMC API response code
# 26. GET /ServiceEndpoints/UpdateService/RedfishEndpoints/{xname} invalid nodeBMC API response code
---
test_name: Query the ServiceEndpoints collection

stages:
  # 1. GET /ServiceEndpoints API response code
  # 2. GET /ServiceEndpoints API response body
  - name: Ensure that we can conduct a query on the ServiceEndpoints collection
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200
      json:
        ServiceEndpoints: !anything
      save:
        json:
          ID: ServiceEndpoints[0].RedfishEndpointID

---
test_name: Query the ServiceEndpoints collection for the AccountService

stages:
  # 3. GET /ServiceEndpoints/AccountService API response code
  # 4. GET /ServiceEndpoints/AccountService API response body
  - name: Ensure that we can conduct a query on the ServiceEndpoints collection for the AccountService
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/AccountService"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200
      save:
        json:
          id: ServiceEndpoints[0].RedfishEndpointID

  # 5. GET /ServiceEndpoints?service=AccountService API response code
  - name: Ensure that we can conduct a query on the ServiceEndpoints collection for the AccountService using the service query parameter
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints?service=AccountService"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200

  # 6. GET /ServiceEndpoints/AccountService/RedfishEndpoints/{xname} nodeBMC API response code
  - name: Ensure that we can conduct a query for a specific xname in the ServiceEndpoints collection for the AccountService
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/AccountService/RedfishEndpoints/{id}"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200

---
test_name: Query the ServiceEndpoints collection for the EventService

stages:
  # 7. GET /ServiceEndpoints/EventService API response code
  # 8. GET /ServiceEndpoints/EventService API response body
  - name: Ensure that we can conduct a query on the ServiceEndpoints collection for the EventService
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/EventService"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200
      save:
        json:
          id: ServiceEndpoints[0].RedfishEndpointID

  # 9. GET /ServiceEndpoints?service=EventService API response code
  - name: Ensure that we can conduct a query on the ServiceEndpoints collection for the EventService using the service query parameter
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints?service=EventService"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200

  # 10. GET /ServiceEndpoints/EventService/RedfishEndpoints/{xname} nodeBMC API response code
  - name: Ensure that we can conduct a query for a specific xname in the ServiceEndpoints collection for the EventService
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/EventService/RedfishEndpoints/{id}"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200

---
test_name: Query the ServiceEndpoints collection for the SessionService

stages:
  # 11. GET /ServiceEndpoints/SessionService API response code
  # 12. GET /ServiceEndpoints/SessionService API response body
  - name: Ensure that we can conduct a query on the ServiceEndpoints collection for the SessionService
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/SessionService"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200
      save:
        json:
          id: ServiceEndpoints[0].RedfishEndpointID

  # 13. GET /ServiceEndpoints?service=SessionService API response code
  - name: Ensure that we can conduct a query on the ServiceEndpoints collection for the SessionService using the service query parameter
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints?service=SessionService"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200

  # 14. GET /ServiceEndpoints/SessionService/RedfishEndpoints/{xname} nodeBMC API response code
  - name: Ensure that we can conduct a query for a specific xname in the ServiceEndpoints collection for the SessionService
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/SessionService/RedfishEndpoints/{id}"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200

---
test_name: Query the ServiceEndpoints collection for the UpdateService

stages:
  # 15. GET /ServiceEndpoints/UpdateService API response code
  # 16. GET /ServiceEndpoints/UpdateService API response body
  - name: Ensure that we can conduct a query on the ServiceEndpoints collection for the UpdateService
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/UpdateService"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200
      save:
        json:
          id: ServiceEndpoints[0].RedfishEndpointID

  # 17. GET /ServiceEndpoints?service=UpdateService API response code
  - name: Ensure that we can conduct a query on the ServiceEndpoints collection for the UpdateService using the service query parameter
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints?service=UpdateService"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200

  # 18. GET /ServiceEndpoints/UpdateService/RedfishEndpoints/{xname} nodeBMC API response code
  - name: Ensure that we can conduct a query for a specific xname in the ServiceEndpoints collection for the UpdateService
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/UpdateService/RedfishEndpoints/{id}"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 200

---
test_name: Attempt to query the ServiceEndpoints collection for the AccountService with a valid but nonexistent xname

stages:
  # 19. GET /ServiceEndpoints/AccountService/RedfishEndpoints/{xname} valid nonexistent nodeBMC API response code
  - name: Verify failure when providing a valid but nonexistent xname for the AccountService in the ServiceEndpoints collection
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/AccountService/RedfishEndpoints/x1025c7s4b4"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 404

---
test_name: Attempt to query the ServiceEndpoints collection for the EventService with a valid but nonexistent xname

stages:
  # 20. GET /ServiceEndpoints/EventService/RedfishEndpoints/{xname} valid nonexistent nodeBMC API response code
  - name: Verify failure when providing a valid but nonexistent xname for the EventService in the ServiceEndpoints collection
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/EventService/RedfishEndpoints/x1025c7s4b4"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 404

---
test_name: Attempt to query the ServiceEndpoints collection for the SessionService with a valid but nonexistent xname

stages:
  # 21. GET /ServiceEndpoints/SessionService/RedfishEndpoints/{xname} valid nonexistent nodeBMC API response code
  - name: Verify failure when providing a valid but nonexistent xname for the SessionService in the ServiceEndpoints collection
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/SessionService/RedfishEndpoints/x1025c7s4b4"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 404

---
test_name: Attempt to query the ServiceEndpoints collection for the UpdateService with a valid but nonexistent xname

stages:
  # 22. GET /ServiceEndpoints/UpdateService/RedfishEndpoints/{xname} valid nonexistent nodeBMC API response code
  - name: Verify failure when providing a valid but nonexistent xname for the UpdateService in the ServiceEndpoints collection
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/UpdateService/RedfishEndpoints/x1025c7s4b4"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 404

---
test_name: Attempt to query the ServiceEndpoints collection for the AccountService with an invalid xname

stages:
  # 23. GET /ServiceEndpoints/AccountService/RedfishEndpoints/{xname} invalid nodeBMC API response code
  - name: Verify failure when providing an invalid xname for the AccountService in the ServiceEndpoints collection
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/AccountService/RedfishEndpoints/x1025000c7s4b4"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 400

---
test_name: Attempt to query the ServiceEndpoints collection for the EventService with an invalid xname

stages:
  # 24. GET /ServiceEndpoints/EventService/RedfishEndpoints/{xname} invalid nodeBMC API response code
  - name: Verify failure when providing an invalid xname for the EventService in the ServiceEndpoints collection
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/EventService/RedfishEndpoints/x1025000c7s4b4"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 400

---
test_name: Attempt to query the ServiceEndpoints collection for the SessionService with an invalid xname

stages:
  # 25. GET /ServiceEndpoints/SessionService/RedfishEndpoints/{xname} invalid nodeBMC API response code
  - name: Verify failure when providing an invalid xname for the SessionService in the ServiceEndpoints collection
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/SessionService/RedfishEndpoints/x1025000c7s4b4"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 400

---
test_name: Attempt to query the ServiceEndpoints collection for the UpdateService with an invalid xname

stages:
  # 26. GET /ServiceEndpoints/UpdateService/RedfishEndpoints/{xname} invalid nodeBMC API response code
  - name: Verify failure when providing an invalid xname for the UpdateService in the ServiceEndpoints collection
    request:
      url: "{base_url}/smd/hsm/v1/Inventory/ServiceEndpoints/UpdateService/RedfishEndpoints/x1025000c7s4b4"
      method: GET
      headers:
        Authorization: "Bearer {access_token}"
      verify: !bool "{verify}"
    response:
      status_code: 400
